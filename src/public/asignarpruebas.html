<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Asignación de Pruebas</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    body {
      background-image: url('https://journey.app/noticias/wp-content/uploads/2020/04/Greciatourpuntocom.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      color: black;
    }

    .container {
      background-color: rgba(255, 255, 255, 0.8);
      padding: 20px;
      border-radius: 10px;
      margin-top: 50px;
    }
  </style>
</head>

<body>

  <div class="container">
    <h2 class="mb-4">Asignación de Pruebas</h2>

    <form>
      <div class="form-group">
        <label for="tipoPrueba">Tipo de prueba:</label>
        <select class="form-control" id="tipoPrueba" name="tipoPrueba">
          <option value="" disabled selected>Selecciona el tipo de prueba</option>
          <option value="libre">Libre</option>
          <option value="eleccion">Eleccion</option>
          <option value="valoracion">Valoración</option>
        </select>
      </div>

      <div class="form-group">
        <label for="prueba">Seleccione la prueba:</label>
        <select class="form-control" id="prueba" name="prueba"></select>
      </div>

      <div class="row">
        <div class="col-md-6">
          <label for="usuarios">Usuarios disponibles:</label>
          <select multiple class="form-control" id="usuarios" name="usuarios[]">
          </select>
        </div>

        <div class="col-md-6">
          <label for="usuariosSeleccionados">Usuarios seleccionados:</label>
          <select multiple class="form-control" id="usuariosSeleccionados" name="usuariosSeleccionados"></select>
        </div>
      </div>

      <div class="mt-3">
        <button type="button" class="btn btn-primary" onclick="agregarUsuario()">Agregar Usuario</button>
        <button type="button" class="btn btn-danger" onclick="quitarUsuario()">Quitar Usuario</button>
        <button type="button" class="btn btn-success" onclick="seleccionarTodos()">Seleccionar Todos</button>
      </div>

      <button type="button" class="btn btn-primary mt-3" onclick="asignarPrueba()">Asignar Prueba</button>
    </form>
  </div>

  <script>
    document.getElementById('tipoPrueba').addEventListener('change', cargarDatosPrueba);

    function cargarDatosPrueba() {
      var tipoPrueba = document.getElementById('tipoPrueba').value;
      var pruebaSelect = document.getElementById('prueba');
      var token = sessionStorage.getItem('token');

      // Verificar que se haya seleccionado un tipo de prueba
      if (!tipoPrueba) {
        alert('Por favor, selecciona un tipo de prueba.');
        return;
      }

      // Ajusta la URL de la API según tu caso
      var apiUrl = '';

      // Realizar la petición a la API en función del tipo de prueba seleccionada
      if (tipoPrueba === 'libre') {
        apiUrl = 'http://127.0.0.1:8000/api/dioses/recuperar/pruebas/libre';
      } else if (tipoPrueba === 'eleccion') {
        apiUrl = 'http://127.0.0.1:8000/api/dioses/recuperar/pruebas/eleccion';
      } else if (tipoPrueba === 'valoracion') {
        apiUrl = 'http://127.0.0.1:8000/api/dioses/recuperar/pruebas/valoracion';
      }

      // Limpiar opciones actuales del select de prueba
      pruebaSelect.innerHTML = '';

      // Hacer la petición a la API incluyendo el token
      fetch(apiUrl, {
        method: 'GET',
        headers: {
          'Authorization': 'Bearer ' + token
        }
      })
        .then(response => response.json())
        .then(data => {
          console.log(data.data)
          for (var i = 0; i < data.data.length; i++) {
            var option = document.createElement("option");
            option.text = data.data[i].pregunta;
            option.value = data.data[i].id;
            pruebaSelect.add(option);
          }
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    }

    function cargarDatosUsuarios() {
      var usuariosSelect = document.getElementById('usuarios');
      var token = sessionStorage.getItem('token');

      // Ajusta la URL de la API según tu caso
      var apiUrl = 'http://127.0.0.1:8000/api/dioses/recuperar/humanos';

      // Hacer la petición a la API incluyendo el token
      fetch(apiUrl, {
        method: 'GET',
        headers: {
          'Authorization': 'Bearer ' + token
        }
      })
        .then(response => response.json())
        .then(data => {
          console.log(data.data)
          // Limpiar opciones actuales del select de usuarios
          usuariosSelect.innerHTML = '';

          // Procesar los datos recibidos y llenar el select de usuarios
          for (var i = 0; i < data.data.length; i++) {
            var option = document.createElement("option");
            option.text = data.data[i].nombre;
            option.value = data.data[i].id;
            usuariosSelect.add(option);
          }
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    }


    document.addEventListener('DOMContentLoaded', cargarDatosUsuarios);

    // Resto de funciones aquí

  </script>

</body>

</html>